# DISC Test App - Streamlit Version (24 questions - Persian)

import streamlit as st
import pandas as pd
import plotly.express as px
from fpdf import FPDF
import base64

# Initialize session state
if 'responses' not in st.session_state:
    st.session_state.responses = []
    st.session_state.current_q = 0

# Questions list (24 Persian DISC questions)
questions = [
    {
        "text": "ุฏุฑ ฺฉ ุฌูุณู ฺฉุงุฑ ุชุฑุฌุญ ูโุฏูู:",
        "options": [
            {"label": "ฺฉูุชุฑู ุฌูุณู ุฑุง ุจูโุฏุณุช ุจฺฏุฑู", "dimension": "D"},
            {"label": "ุจุง ุงูุฑุงุฏ ุฌุฏุฏ ุงุฑุชุจุงุท ุจุฑูุฑุงุฑ ฺฉูู", "dimension": "I"},
            {"label": "ุดูููุฏู ุฎูุจ ุจุงุดู ู ูุถุง ุขุฑุงู ุญูุธ ุดูุฏ", "dimension": "S"},
            {"label": "ูุทูุฆู ุดูู ูููโฺุฒ ุทุจู ุจุฑูุงูู ูพุด ูโุฑูุฏ", "dimension": "C"},
        ]
    },
    {
        "text": "ููุช ุจุง ฺฉ ฺุงูุด ุณุฎุช ููุงุฌู ูโุดูู:",
        "options": [
            {"label": "ุณุฑุน ุชุตูู ูโฺฏุฑู ู ุนูู ูโฺฉูู", "dimension": "D"},
            {"label": "ุงุฒ ุฏฺฏุฑุงู ุงููุงู ูโฺฏุฑู ุง ูุธุฑุดุงู ุฑุง ูโูพุฑุณู", "dimension": "I"},
            {"label": "ุตุจุฑ ูโฺฉูู ุชุง ุดุฑุงุท ุจูุชุฑ ุดูุฏ", "dimension": "S"},
            {"label": "ุงุทูุงุนุงุช ุฏูู ุฌูุนโุขูุฑ ูโฺฉูู ู ุจุง ุชุญูู ุฌูู ูโุฑูู", "dimension": "C"},
        ]
    },
    {
        "text": "ุฏุฑ ูพุฑูฺูโูุง ุชู ูุนูููุงู ูู:",
        "options": [
            {"label": "ููุด ุฑูุจุฑ ุฑุง ุจุฑุนูุฏู ูโฺฏุฑู", "dimension": "D"},
            {"label": "ุจุงุนุซ ุงูฺฏุฒูโุจุฎุด ุจู ุชู ูโุดูู", "dimension": "I"},
            {"label": "ุจุง ููู ููุงููฺฏ ู ููุฑุงู ูุณุชู", "dimension": "S"},
            {"label": "ุฑู ุฑููุฏ ู ุฏูุช ุชูุฑฺฉุฒ ูโฺฉูู", "dimension": "C"},
        ]
    },
    {
        "text": "ููุช ุจุฑูุงููโุง ุชุบุฑ ูโฺฉูุฏ:",
        "options": [
            {"label": "ุณุน ูโฺฉูู ฺฉูุชุฑู ุดุฑุงุท ุฑุง ุญูุธ ฺฉูู", "dimension": "D"},
            {"label": "ุจู ุฏฺฏุฑุงู ุงูฺฏุฒู ูโุฏูู ุชุง ููุงููฺฏ ุดููุฏ", "dimension": "I"},
            {"label": "ุฎููุณุฑุฏ ุฎูุฏู ุฑุง ุญูุธ ูโฺฉูู", "dimension": "S"},
            {"label": "ุฏูุงู ุชุบุฑ ุฑุง ุจุฑุฑุณ ูโฺฉูู", "dimension": "C"},
        ]
    },
    {
        "text": "ุฏุฑ ููุงุฌูู ุจุง ุถุฑุจโุงูุนุฌู ฺฉุงุฑ:",
        "options": [
            {"label": "ุจูโุณุฑุนุช ุชุตูู ูโฺฏุฑู", "dimension": "D"},
            {"label": "ุฏฺฏุฑุงู ุฑุง ุชุดูู ุจู ููฺฉุงุฑ ูโฺฉูู", "dimension": "I"},
            {"label": "ุจุง ุขุฑุงูุด ุนูู ูโฺฉูู", "dimension": "S"},
            {"label": "ุจุฑูุงููโุฑุฒ ุฏูู ุงูุฌุงู ูโุฏูู", "dimension": "C"},
        ]
    },
    {
        "text": "ุฏุฑ ุจุฑุฎูุฑุฏ ุจุง ููฺฉุงุฑุงู ุฌุฏุฏ:",
        "options": [
            {"label": "ูุณุชูู ู ุตุฑุญ ูุณุชู", "dimension": "D"},
            {"label": "ุฎู ุฒูุฏ ุตูู ูโุดูู", "dimension": "I"},
            {"label": "ุจุง ุงุญุชุฑุงู ู ุขุฑุงูุด ุจุฑุฎูุฑุฏ ูโฺฉูู", "dimension": "S"},
            {"label": "ุณุน ูโฺฉูู ุฏูู ู ุญุฑููโุง ุจุงุดู", "dimension": "C"},
        ]
    },
    {
        "text": "ููุช ุฏุฑ ุฌูุณูโุง ูุฎุงููุช ูุทุฑุญ ูโุดูุฏ:",
        "options": [
            {"label": "ููุทูโูุธุฑ ุฎูุฏ ุฑุง ูุญฺฉู ุจุงู ูโฺฉูู", "dimension": "D"},
            {"label": "ุณุน ูโฺฉูู ูุถุง ุฑุง ุขุฑุงู ู ูุซุจุช ูฺฏู ุฏุงุฑู", "dimension": "I"},
            {"label": "ุจู ุญุฑู ููู ฺฏูุด ูโุฏูู", "dimension": "S"},
            {"label": "ูุณุชูุฏ ู ููุทู ูพุงุณุฎ ูโุฏูู", "dimension": "C"},
        ]
    },
    {
        "text": "ุฏุฑ ูพุฑูฺูโูุง ฺูุฏูุฑุญููโุง:",
        "options": [
            {"label": "ูุฑุญูู ุจู ูุฑุญูู ูพุด ูโุฑูู ุงูุง ุณุฑุน", "dimension": "D"},
            {"label": "ุฏุฑ ูุฑ ูุฑุญูู ุจุง ุงุนุถุง ุชู ูุดูุฑุช ูโฺฉูู", "dimension": "I"},
            {"label": "ุฑููุฏ ุฑุง ุขุฑุงู ู ููุธู ูพุด ูโุจุฑู", "dimension": "S"},
            {"label": "ุจุฑุง ูุฑ ูุฑุญูู ูุณุชูุฏุงุช ุฏูู ุชูู ูโฺฉูู", "dimension": "C"},
        ]
    },
    {
        "text": "ุฏุฑ ููุงุฌูู ุจุง ูุณุฆููุช ุฌุฏุฏ:",
        "options": [
            {"label": "ุจูุงูุงุตูู ุขู ุฑุง ูโูพุฐุฑู ู ุดุฑูุน ูโฺฉูู", "dimension": "D"},
            {"label": "ุจุง ุฏฺฏุฑุงู ุฏุฑ ููุฑุฏ ุขู ุตุญุจุช ูโฺฉูู", "dimension": "I"},
            {"label": "ุณุน ูโฺฉูู ุจู ุขุฑุงู ูุงุฑุฏ ฺฉุงุฑ ุดูู", "dimension": "S"},
            {"label": "ุงุจุชุฏุง ููู ุฌุฒุฆุงุช ุฑุง ุจุฑุฑุณ ูโฺฉูู", "dimension": "C"},
        ]
    },
    {
        "text": "ุจุฑุง ุชุนุทูุงุช ุขุฎุฑ ููุชู:",
        "options": [
            {"label": "ุจุฑูุงููโุง ูุนุงู ู ูุงุฌุฑุงุฌูุงูู ุงูุชุฎุงุจ ูโฺฉูู", "dimension": "D"},
            {"label": "ุฏูุฑูู ุจุง ุฏูุณุชุงู ุฑุง ุชุฑุฌุญ ูโุฏูู", "dimension": "I"},
            {"label": "ุชูุฑุญ ุขุฑุงู ูุซู ฺฉุชุงุจ ุง ุทุจุนุชโฺฏุฑุฏ ุฑุง ุชุฑุฌุญ ูโุฏูู", "dimension": "S"},
            {"label": "ุจุฑูุงููโุฑุฒ ุฏูู ุจุฑุง ููู ุฌุฒุฆุงุช ุฏุงุฑู", "dimension": "C"},
        ]
    },
    {
        "text": "ุฏุฑ ููุงุฌูู ุจุง ุงุดุชุจุงู ุฏฺฏุฑุงู:",
        "options": [
            {"label": "ุจุง ูุงุทุนุช ุชุฐฺฉุฑ ูโุฏูู", "dimension": "D"},
            {"label": "ุจู ุดููโุง ูุซุจุช ุขู ุฑุง ูุทุฑุญ ูโฺฉูู", "dimension": "I"},
            {"label": "ุณุน ูโฺฉูู ุดุฑุงุท ุฑุง ุฏุฑฺฉ ฺฉูู", "dimension": "S"},
            {"label": "ุฌุฒุฆุงุช ุงุดุชุจุงู ุฑุง ูุณุชูุฏ ูโฺฉูู", "dimension": "C"},
        ]
    },
    {
        "text": "ููุช ฺฉุงุฑ ุฌุฏุฏ ุดุฑูุน ูโุดูุฏ:",
        "options": [
            {"label": "ููุฑุงู ูุงุฑุฏ ุนูู ูโุดูู", "dimension": "D"},
            {"label": "ุฏุฑุจุงุฑู ุขู ุจุง ุงุดุชุงู ุตุญุจุช ูโฺฉูู", "dimension": "I"},
            {"label": "ุจุง ููุงููฺฏ ู ุตุจุฑ ฺฉุงุฑ ุฑุง ุดุฑูุน ูโฺฉูู", "dimension": "S"},
            {"label": "ุงุจุชุฏุง ูุฑุงุญู ุฑุง ุจุฑุฑุณ ู ุชุญูู ูโฺฉูู", "dimension": "C"},
        ]
    }
    {
        "text": "ุฏุฑ ููุงุฌูู ุจุง ูุฑุฏ ุจุง ูุธุฑ ูุฎุงูู:",
        "options": [
            {"label": "ูุงุทุนุงูู ุงุฒ ููุถุน ุฎูุฏู ุฏูุงุน ูโฺฉูู", "dimension": "D"},
            {"label": "ุณุน ูโฺฉูู ุงู ุฑุง ุจุง ุดูุฎ ู ูุจุฎูุฏ ุขุฑุงู ฺฉูู", "dimension": "I"},
            {"label": "ุจุง ุงุญุชุฑุงู ฺฏูุด ูโุฏูู ู ูุธุฑ ูโุฏูู", "dimension": "S"},
            {"label": "ูพุงุณุฎ ูุณุชูุฏ ู ููุทู ูโุฏูู", "dimension": "C"},
        ]
    },
    {
        "text": "ุฏุฑ ุดุฑุงุท ุจุญุฑุงู ฺฺฏููู ูุงฺฉูุด ูุดุงู ูโุฏูู:",
        "options": [
            {"label": "ุณุฑุน ฺฉูุชุฑู ุงูุถุงุน ุฑุง ุจูโุฏุณุช ูโฺฏุฑู", "dimension": "D"},
            {"label": "ุจู ุฏฺฏุฑุงู ุงูุฏ ู ุงูฺฏุฒู ูโุฏูู", "dimension": "I"},
            {"label": "ุณุน ูโฺฉูู ุขุฑุงูุด ุฑุง ุญูุธ ฺฉูู", "dimension": "S"},
            {"label": "ุงุทูุงุนุงุช ู ููุงูู ูุฑุจูุท ุฑุง ุจุฑุฑุณ ูโฺฉูู", "dimension": "C"},
        ]
    },
    {
        "text": "ููุช ูพุฑูฺูโุง ุดฺฉุณุช ูโุฎูุฑุฏ:",
        "options": [
            {"label": "ุนูุช ุฑุง ุจุฑุฑุณ ฺฉุฑุฏู ู ุฑุงูโุญู ูพุดููุงุฏ ูโุฏูู", "dimension": "D"},
            {"label": "ุชู ุฑุง ุจู ุงุฏุงูู ุฏุงุฏู ุชุดูู ูโฺฉูู", "dimension": "I"},
            {"label": "ุจุง ููุฏู ุงุฒ ุงุนุถุง ุชู ุญูุงุช ูโฺฉูู", "dimension": "S"},
            {"label": "ูุณุชูุฏุงุช ุฑุง ุชุญูู ูโฺฉูู ุชุง ุงุดุชุจุงูุงุช ุฑุง ุจูููู", "dimension": "C"},
        ]
    },
    {
        "text": "ุฏุฑ ุดุฑุงุท ุนุฏู ูุทุนุช:",
        "options": [
            {"label": "ุจุง ุฌุณุงุฑุช ุชุตูู ูโฺฏุฑู", "dimension": "D"},
            {"label": "ุณุน ูโฺฉูู ูฺฏุฑุงู ุฏฺฏุฑุงู ุฑุง ฺฉู ฺฉูู", "dimension": "I"},
            {"label": "ููุชุธุฑ ุดูุงูโุชุฑ ุดุฏู ุดุฑุงุท ูโูุงูู", "dimension": "S"},
            {"label": "ุงุทูุงุนุงุช ุจุดุชุฑ ุฌูุนโุขูุฑ ูโฺฉูู", "dimension": "C"},
        ]
    },
    {
        "text": "ุฏุฑ ุดุฑูุน ููฺฉุงุฑ ุฌุฏุฏ:",
        "options": [
            {"label": "ุจูโุณุฑุนุช ูุณุฆููุชโูุง ุฑุง ูุดุฎุต ูโฺฉูู", "dimension": "D"},
            {"label": "ุฑูุงุจุท ุฏูุณุชุงูู ุจุฑูุฑุงุฑ ูโฺฉูู", "dimension": "I"},
            {"label": "ุงุนุชูุงุฏุณุงุฒ ูโฺฉูู ู ุตุจูุฑู", "dimension": "S"},
            {"label": "ููุงูู ู ุงูุชุธุงุฑุงุช ุฑุง ุฏูู ุจุฑุฑุณ ูโฺฉูู", "dimension": "C"},
        ]
    },
    {
        "text": "ุฏุฑ ุฒูุงู ุชุตููโฺฏุฑโูุง ููู:",
        "options": [
            {"label": "ุจุง ูุงุทุนุช ุชุตูู ูโฺฏุฑู", "dimension": "D"},
            {"label": "ุชุฃุซุฑ ุขู ุจุฑ ุฏฺฏุฑุงู ุฑุง ุฏุฑ ูุธุฑ ูโฺฏุฑู", "dimension": "I"},
            {"label": "ุจุง ูุดูุฑุช ฺฏุฑูู ุจู ูุชุฌู ูโุฑุณู", "dimension": "S"},
            {"label": "ุชูุงู ุฌูุงูุจ ุฑุง ุชุญูู ุจุฑุฑุณ ูโฺฉูู", "dimension": "C"},
        ]
    },
    {
        "text": "ุฏุฑ ุฒูุงู ุดุฑูุน ฺฉุงุฑ ุฌุฏุฏ:",
        "options": [
            {"label": "ุณุฑุน ุงูุฏุงู ูโฺฉูู", "dimension": "D"},
            {"label": "ุจุง ูุฌุงู ูุงุฑุฏ ุชู ูโุดูู", "dimension": "I"},
            {"label": "ุณุน ูโฺฉูู ููุงููฺฏ ุจุง ูุญุท ุฌุฏุฏ ุจุงุดู", "dimension": "S"},
            {"label": "ูุฑุขูุฏูุง ู ุฑูุดโูุง ุฑุง ุงุฏุฏุงุดุช ูโฺฉูู", "dimension": "C"},
        ]
    },
    {
        "text": "ููุช ฺฉุณ ุนููฺฉุฑุฏ ุถุนู ุฏุงุฑุฏ:",
        "options": [
            {"label": "ูุณุชูู ุจู ุงู ุจุงุฒุฎูุฑุฏ ูโุฏูู", "dimension": "D"},
            {"label": "ุจุง ฺฏูุชุงุฑ ูุซุจุช ุชูุงุดุด ุฑุง ุชุญุณู ูโฺฉูู", "dimension": "I"},
            {"label": "ุจู ุงู ฺฉูฺฉ ูโฺฉูู ูพุดุฑูุช ฺฉูุฏ", "dimension": "S"},
            {"label": "ุฌุฒุฆุงุช ุฑุง ุจุฑุฑุณ ูโฺฉูู ู ุฑุงูููุง ุฏูู ูโุฏูู", "dimension": "C"},
        ]
    },
    {
        "text": "ุฏุฑ ฺฉุงุฑูุง ุชู:",
        "options": [
            {"label": "ูุธุงู ุฑุง ุชูุณู ูโฺฉูู ู ุฌูู ูโุจุฑู", "dimension": "D"},
            {"label": "ุฌู ุฑุง ุดุงุฏ ู ูพุฑุงูุฑฺ ูฺฏู ูโุฏุงุฑู", "dimension": "I"},
            {"label": "ุจุงุนุซ ููุงููฺฏ ู ููุฏู ูโุดูู", "dimension": "S"},
            {"label": "ุฑู ฺฉูุช ู ุฏูุช ฺฉุงุฑ ุชูุฑฺฉุฒ ุฏุงุฑู", "dimension": "C"},
        ]
    },
    {
        "text": "ุงฺฏุฑ ูุงุฒู ุจุงุดุฏ ฺฉุงุฑ ุชฺฉุฑุงุฑ ุงูุฌุงู ุฏูู:",
        "options": [
            {"label": "ุณุฑุน ุงูุฌุงู ูโุฏูู ุชุง ุจู ุณุฑุงุบ ฺฉุงุฑ ุจุนุฏ ุจุฑูู", "dimension": "D"},
            {"label": "ุณุน ูโฺฉูู ุขู ุฑุง ุณุฑฺฏุฑูโฺฉููุฏู ฺฉูู", "dimension": "I"},
            {"label": "ุจุง ุญูุตูู ู ูุธู ุงูุฌุงูุด ูโุฏูู", "dimension": "S"},
            {"label": "ุฏุฑ ูุฑ ุจุงุฑ ุงูุฌุงูุ ุฏูุช ุจุดุชุฑ ุจู ุฎุฑุฌ ูโุฏูู", "dimension": "C"},
        ]
    },
    {
        "text": "ุฏุฑ ุตูุฑุช ุจุฑูุฒ ุงุดุชุจุงู ุงุฒ ุฌุงูุจ ูู:",
        "options": [
            {"label": "ูุณุฆููุช ุฑุง ูโูพุฐุฑู ู ุฌุจุฑุงู ูโฺฉูู", "dimension": "D"},
            {"label": "ุจุง ุตุฑุงุญุช ู ููุฑุจุงู ุนุฐุฑุฎูุงู ูโฺฉูู", "dimension": "I"},
            {"label": "ุณุน ูโฺฉูู ุชูุด ุงุฌุงุฏ ูฺฉูู", "dimension": "S"},
            {"label": "ุนูุช ุงุดุชุจุงู ุฑุง ุฏูู ุชุญูู ูโฺฉูู", "dimension": "C"},
        ]
    },
    {
        "text": "ุฏุฑ ุงูุชุฎุงุจ ุดุบู ุฌุฏุฏุ ุงูููุช ูู:",
        "options": [
            {"label": "ุงูฺฉุงู ูพุดุฑูุช ุณุฑุน ู ูุณุฆููุชโูพุฐุฑ ุงุณุช", "dimension": "D"},
            {"label": "ูุญุท ฺฉุงุฑ ูุซุจุช ู ุงุฌุชูุงุน ุงุณุช", "dimension": "I"},
            {"label": "ุซุจุงุช ุดุบู ู ููฺฉุงุฑ ุฏูุณุชุงูู ุงุณุช", "dimension": "S"},
            {"label": "ุดูุงูุช ููุดโูุง ู ุณุงุฎุชุงุฑ ุณุงุฒูุงู ุงุณุช", "dimension": "C"},
        ]
    }
]

# Scoring dictionary
scores = {"D": 0, "I": 0, "S": 0, "C": 0}

# Render one question at a time
q_index = st.session_state.current_q
if q_index < len(questions):
    st.subheader(f"ุณุคุงู {q_index + 1} ุงุฒ {len(questions)}")
    q = questions[q_index]
    st.write(q["text"])

    most = st.radio("ุจุดุชุฑู ุดุจุงูุช ุจู ูู ุฏุงุฑุฏ:", q["options"], key=f"most_{q_index}", format_func=lambda x: x["label"])
    least = st.radio("ฺฉูุชุฑู ุดุจุงูุช ุจู ูู ุฏุงุฑุฏ:", q["options"], key=f"least_{q_index}", format_func=lambda x: x["label"])

    if st.button("ุซุจุช ู ุฑูุชู ุจู ุณุคุงู ุจุนุฏ"):
        if most == least:
            st.warning("ูุทูุงู ฺฏุฒููโูุง ูุชูุงูุช ุจุฑุง ุจุดุชุฑู ู ฺฉูุชุฑู ุงูุชุฎุงุจ ฺฉูุฏ.")
        else:
            st.session_state.responses.append({"most": most["dimension"], "least": least["dimension"]})
            st.session_state.current_q += 1
            st.experimental_rerun()

# Process results
if q_index >= len(questions):
    for resp in st.session_state.responses:
        scores[resp["most"]] += 1
        scores[resp["least"]] -= 1

    # Normalize
    total = sum([abs(v) for v in scores.values()])
    perc = {k: int((v / total) * 100) if total != 0 else 0 for k, v in scores.items()}

    st.subheader("ูุชุงุฌ ุขุฒููู DISC ุดูุง:")
    df = pd.DataFrame.from_dict(perc, orient='index', columns=['Score'])
    st.dataframe(df)
    fig = px.bar(df, x=df.index, y='Score', title="DISC Dimensions")
    st.plotly_chart(fig)

    # Determine personality type
    sorted_traits = sorted(perc.items(), key=lambda x: x[1], reverse=True)
    disc_type = sorted_traits[0][0] + (sorted_traits[1][0] if sorted_traits[1][1] > 25 else "")
    st.markdown(f"### Your DISC Type: **{disc_type}**")

    # Generate PDF
    class PDF(FPDF):
        def header(self):
            self.set_font('Arial', 'B', 12)
            self.cell(0, 10, 'DISC Personality Test Result', ln=True, align='C')

    pdf = PDF()
    pdf.add_page()
    pdf.set_font('Arial', '', 12)
    pdf.cell(0, 10, f'DISC Type: {disc_type}', ln=True)
    for k, v in perc.items():
        pdf.cell(0, 10, f'{k}: {v}%', ln=True)

    pdf_file = f"disc_result.pdf"
    pdf.output(pdf_file)
    
    with open(pdf_file, "rb") as f:
        b64 = base64.b64encode(f.read()).decode()
        href = f'<a href="data:application/octet-stream;base64,{b64}" download="disc_result.pdf">๐ ุฏุงูููุฏ ฺฏุฒุงุฑุด PDF</a>'
        st.markdown(href, unsafe_allow_html=True)

    st.success("ุขุฒููู ฺฉุงูู ุดุฏ! ูโุชูุงูุฏ ูุงู PDF ูุชุฌู ุฑุง ุฏุงูููุฏ ฺฉูุฏ.")
